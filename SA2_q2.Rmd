---
title: "stats"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r }
s5 <- read.csv('sample.csv')
ncol(s5)
colnames(s5)

```

#####LOGISTIC REGRESSION
```{r }
s5$acheivers[s5$TOTAL > 70] <- 1
s5$acheivers[s5$TOTAL <= 70] <- 0
dim(s5)

```


###Split into training and testing samples
```{r }

#install.packages('caTools')
library(caTools)
set.seed(11)
split <- sample.split(s5$acheivers, SplitRatio = 0.70)

train_sample <- subset(s5, split == TRUE)
test_sample <- subset(s5, split == FALSE)
```


##primary model
```{r }

MODEL1 <- glm(acheivers ~  MTONGUE_T:Gender_F + RELIGN_H:Gender_F:CASTE_OT:AGE+ CASTE_SC:MTONGUE_T:AGE:RELIGN_H + CASTE_SC:MTONGUE_T + CASTE_SC:OCCU_A:Gender_F + MTONGUE_T + RELIGN_H:Gender_F,data=train_sample, family = binomial)
summary(MODEL1)

```

```{r}

1-pchisq(606.62-588.86,683-676)
```


```{r }

MODEL2 <- glm(acheivers ~ AGE:Gender_F:CASTE_SC + CASTE_SC +RELIGN_H:OCCU_B + Gender_F + MTONGUE_T:Gender_F + Gender_T:RELIGN_H ,data=train_sample, family = binomial)
summary(MODEL2)
```



```{r }
###MODEL OF FITNESS TEST.
anova(MODEL1,MODEL2, test="Chisq")
```



```{r }
options(scipen = 999)
predicted <- predict(MODEL1, newdata = test_sample, type = "response")
fitted.results <- ifelse(predicted > 0.18,1,0)
table(fitted.results)
```



```{r }
x <- fitted.results != test_sample$acheivers

length(which(x == TRUE))

```

###Coefficients can be interpreted using this.
```{r }
tidy(MODEL1)
##for every 1 unit increase in MTONGUE_T, there is increase in log- odds of high-achievers by 0.636 units.

```


```{r }
exp(coef(MODEL1))
```


```{r }
#install.packages('caret')
require(caret)
varImp(MODEL1)

```

```{r }

library(lmtest)
lrtest(MODEL1)

```


##Pseudo- Rsquare test
```{r }
#install.packages('rcompanion')
library(rcompanion)
nagelkerke(MODEL1)
```

```{r }
#Hosmer - lemeshowL test
#install.packages('generalhoslem')
library(generalhoslem)
logitgof(test_sample$acheivers, predicted)

```

```{r }

M1_d<- augment(MODEL1) %>% mutate(index = 1:n())
plot(MODEL1, which = 4, id.n = 2)
M1_d %>% top_n(5, .cooksd)
```


```{r }
###confusion matrix

model1 = table(test_sample$acheivers, predicted > 0.18) %>% prop.table()
model1

```

```{r }
## ROC curve
#install.packages('pROC')
library(pROC)
roccurve <- roc(test_sample$acheivers ~ predicted)
plot(roccurve)
```



###log-likelihood statistic for null model
```{r }
MODEL1$null.deviance
```


##log-likelihood statistic for -2LL model

```{r }
MODEL1$deviance
```

# likelihood ratio p-value
```{r }
1-pchisq(606.62-588.86,683-676)
#we can reject the null hypothesis. And , accept Alternative Hypothesis - it shows that Current model improves base model.
```


```{r }

```

```{r }

```



```{r }

```


```{r }

```



```{r }

```



```{r }

```

